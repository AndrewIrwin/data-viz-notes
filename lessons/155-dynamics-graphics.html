<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>27&nbsp; Dynamic graphics – Data Visualization notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../lessons/140-mapping.html" rel="next">
<link href="../lessons/127-test-data.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="../site_libs/plotly-binding-4.11.0/plotly.js"></script><script src="../site_libs/typedarray-0.1/typedarray.min.js"></script><script src="../site_libs/jquery-3.5.1/jquery.min.js"></script><link href="../site_libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.2/js/crosstalk.min.js"></script><link href="../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="../site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../lessons/155-dynamics-graphics.html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Dynamic graphics</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Data Visualization notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/101-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Invitation to Data Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/102-intro-to-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Computer tools</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/103-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Setting up your computer</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/104-look-at-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Look at data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/105-first-plot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Making your first plot</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/106-version-control.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">What is version control software?</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/302-staying-organized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Staying organized</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/107-grammar-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Grammar of Graphics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/108-ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Using the grammar of graphics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/110-summarizing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Summarizing data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/115-facets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Facetted graphs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/106b-using-LLM-to-learn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Using AI to learn</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/111-reading-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Reading data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/112-reshaping-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Reshaping data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/113-data-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Format tables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/114-asking-questions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Getting help and asking questions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/118-working-with-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Working with models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/119-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/120-gam-loess.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">GAM and LOESS smoothing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/124-collaboration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Collaborating with GitHub</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/301-data-sources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Finding and accessing data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/911-ethics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Accessibility, Bias, and Ethics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/133-reproducible-reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Reproducible reports</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/121-PCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Principal component analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/122-mds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Multidimensional scaling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/123-kmean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">K-means clustering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/125-slides.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Making slides for presentations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/127-test-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Checking your work</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/155-dynamics-graphics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Dynamic graphics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/140-mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Making maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/141-mapping-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Mapping II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/142-mapping-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Alternatives to maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/130-bonus-topics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Working with text, factors, dates and times</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/201-colour.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Using colour well</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/133-themes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Themes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/160-other-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Beyond tidy data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/130-graphics-output.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Graphics formatting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/134-reconstruction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Reconstructing a visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/499-review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Review</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/901-TMI-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">More details about R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lessons/999-metadata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metadata</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#reader-interactions" id="toc-reader-interactions" class="nav-link active" data-scroll-target="#reader-interactions"><span class="header-section-number">27.1</span> Reader interactions</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">27.2</span> Example</a></li>
  <li><a href="#animations" id="toc-animations" class="nav-link" data-scroll-target="#animations"><span class="header-section-number">27.3</span> Animations</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">27.4</span> Further reading</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="dynamic" class="quarto-section-identifier"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Dynamic graphics</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>In this short lesson I’ll introduce two kinds of dynamic graphics. The first is a graphic that allows the reader to interact with the visualization. We’ve already seen 3d graphs that can be rotated, but you can also get information from hovering over data points. A second kind creates an animation to add another dimension (time) to the visualization. This can be helpful to “tell your story”, but it can also be challenging to get the speed of the animation right and to describe it effectively to an audience. That’s why Hans Rosling used his animation (way back in lesson 1) as part of an oral presentation.</p>
<section id="reader-interactions" class="level2" data-number="27.1"><h2 data-number="27.1" class="anchored" data-anchor-id="reader-interactions">
<span class="header-section-number">27.1</span> Reader interactions</h2>
<p>Visualizations that are designed to respond to interactions (clicks, mouse movement) from the reader can show additional detail and provide opportunities for new ways of communication that are not possible with a static visualization. If you, as a creator of a visualization, require the reader to interact with your work to get the full meaning, you may find that your message is not communicated as effectively.</p>
<p>We will use the javascript plotly package, which is easily combined with ggplot graphics, to create some simple interactive visualizations.</p>
</section><section id="example" class="level2" data-number="27.2"><h2 data-number="27.2" class="anchored" data-anchor-id="example">
<span class="header-section-number">27.2</span> Example</h2>
<p>The javascript package plot_ly can be used with R, both in Rstudio and in knitted HTML output. It automatically shows the coordinates of any point you aim your pointer at. It also provides the ability to pan and zoom the plot to focus in on part of the data. When you mouse is over the plot area, a menu appears at the top of the graph. Experiment with each control until you know what they all do.</p>
<p>plot_ly is a bit slow with a large dataset, so I’ll use a subset of the diamonds data.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu">slice_sample</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">plot_ly</span><span class="op">(</span>x <span class="op">=</span> <span class="op">~</span> <span class="va">carat</span>, </span>
<span>          y <span class="op">=</span> <span class="op">~</span> <span class="va">price</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">add_markers</span><span class="op">(</span>color <span class="op">=</span> <span class="op">~</span> <span class="va">color</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d50b249c1d6aab91dcef" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d50b249c1d6aab91dcef">{"x":{"visdat":{"720045f0e015":["function () ","plotlyVisDat"]},"cur_data":"720045f0e015","attrs":{"720045f0e015":{"x":{},"y":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","mode":"markers","color":{},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"carat"},"yaxis":{"domain":[0,1],"automargin":true,"title":"price"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1.21,1.54,2.0299999999999998,0.31,1.01,1.3500000000000001,1,1.78,0.29999999999999999,2.6099999999999999,1.24,1.5,0.51000000000000001,1.54,0.72999999999999998,0.46000000000000002,0.73999999999999999,1.01,0.77000000000000002,1.3600000000000001,0.76000000000000001,1.5,0.76000000000000001,0.78000000000000003,1.27,0.53000000000000003,1.55,1.55,1.1100000000000001,0.40999999999999998,0.95999999999999996,1.21,0.84999999999999998,1.54,0.70999999999999996,0.40000000000000002,1.05,1.5,2.1899999999999999,0.56999999999999995,1.47,1.0600000000000001,1.51,2.2799999999999998,2.2200000000000002,0.39000000000000001,1,1.6499999999999999,1.03],"y":[4559,9215,12078,468,3499,5969,4144,8889,368,17209,5128,6750,1023,8275,2184,746,2468,3555,1843,6626,1904,7515,2307,2312,5669,1106,6805,6890,5051,797,3187,5572,1334,7349,2085,1063,2789,8467,10179,941,7203,3391,9334,16564,18706,539,3293,7943,3893],"type":"scatter","mode":"markers","name":"J","marker":{"color":"rgba(253,231,37,1)","line":{"color":"rgba(253,231,37,1)"}},"textfont":{"color":"rgba(253,231,37,1)"},"error_y":{"color":"rgba(253,231,37,1)"},"error_x":{"color":"rgba(253,231,37,1)"},"line":{"color":"rgba(253,231,37,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1.71,0.71999999999999997,0.29999999999999999,1.02,1.2,0.40999999999999998,0.69999999999999996,0.90000000000000002,1.04,0.29999999999999999,0.46000000000000002,1.4399999999999999,0.70999999999999996,0.70999999999999996,0.53000000000000003,1.22,1.9299999999999999,1,0.42999999999999999,1.01,1.1699999999999999,1.22,1.3,1.21,0.52000000000000002,1.5800000000000001,0.69999999999999996,2.0299999999999998,0.72999999999999998,1,0.31,0.91000000000000003,1.3100000000000001,0.69999999999999996,0.70999999999999996,2.0099999999999998,0.90000000000000002,0.29999999999999999,0.31,1.25,1.51,1.28,0.69999999999999996,1.1000000000000001,1.1399999999999999,1.5,1,1.5600000000000001,1.01,0.85999999999999999,1.1899999999999999,1.1100000000000001,1.26,0.29999999999999999,0.54000000000000004,0.92000000000000004,0.42999999999999999,1.03,1.3300000000000001,0.58999999999999997,0.71999999999999997,0.33000000000000002,1.01,0.34000000000000002,0.29999999999999999,1.6200000000000001,0.69999999999999996,0.40000000000000002,0.29999999999999999,0.56000000000000005,0.32000000000000001,1.01,0.70999999999999996,1.5,0.29999999999999999,1.55,1.24,1.01,1.04,1.54,0.40999999999999998,1.01,0.54000000000000004,0.29999999999999999,2.1899999999999999,0.34000000000000002,0.33000000000000002,1.04,0.90000000000000002,0.69999999999999996,1.02,1.5900000000000001,2.21,2.04,0.77000000000000002],"y":[11104,2594,367,5767,5280,788,1666,3407,4175,552,1040,8426,2173,2145,1350,6149,13278,3472,1218,3999,2935,6419,6806,7938,1125,9176,2390,15683,2756,2035,408,3734,5187,2390,1938,16700,3398,596,408,5395,10010,3942,1235,4235,5863,4620,4088,8858,3665,1828,7207,5506,5207,675,964,3932,730,3530,7887,1371,2177,675,3054,589,422,9526,2287,1035,394,1406,554,4749,2319,11155,709,7256,4812,3563,4135,8258,875,4418,1147,810,11522,689,572,4193,3709,2616,3927,9972,17784,14477,2598],"type":"scatter","mode":"markers","name":"I","marker":{"color":"rgba(143,215,68,1)","line":{"color":"rgba(143,215,68,1)"}},"textfont":{"color":"rgba(143,215,68,1)"},"error_y":{"color":"rgba(143,215,68,1)"},"error_x":{"color":"rgba(143,215,68,1)"},"line":{"color":"rgba(143,215,68,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.32000000000000001,0.65000000000000002,1.2,1.3500000000000001,0.29999999999999999,1.01,1.23,0.90000000000000002,0.71999999999999997,1.1499999999999999,1.03,0.91000000000000003,1.03,1.0800000000000001,1.2,0.54000000000000004,0.34000000000000002,1.8700000000000001,0.41999999999999998,0.31,0.29999999999999999,1.0600000000000001,0.82999999999999996,0.29999999999999999,2.21,0.5,0.54000000000000004,1.02,1.8,0.31,1.7,0.56000000000000005,1.23,1.4099999999999999,1.2,0.56999999999999995,1,0.42999999999999999,1.1200000000000001,0.56999999999999995,1.2,1.0700000000000001,1.2,0.69999999999999996,0.69999999999999996,0.31,1.01,0.31,1.02,0.35999999999999999,0.29999999999999999,0.69999999999999996,0.91000000000000003,0.90000000000000002,1.01,1.01,0.81000000000000005,1.4099999999999999,0.29999999999999999,1.03,0.31,1.0600000000000001,0.34999999999999998,0.90000000000000002,0.35999999999999999,1.24,0.80000000000000004,1.54,0.70999999999999996,1.02,0.69999999999999996,0.40000000000000002,1.05,1,1.01,1.53,1,1.54,0.59999999999999998,0.40000000000000002,1.1200000000000001,1.2,1.21,1.1799999999999999,2.0099999999999998,0.41999999999999998,0.31,0.59999999999999998,1.3100000000000001,1.6000000000000001,0.32000000000000001,0.69999999999999996,1.27,1.45,1.01,1,1.03,1.0700000000000001,0.37,2.0099999999999998,1.02,2.0499999999999998,2.0299999999999998,1.0900000000000001,2.0800000000000001,1.23,0.52000000000000002,0.69999999999999996,0.33000000000000002,0.69999999999999996,1.01,0.56999999999999995,0.34000000000000002,1.25,1.1499999999999999,0.40000000000000002,0.72999999999999998,0.69999999999999996,1.1499999999999999,0.34000000000000002,0.33000000000000002,0.92000000000000004,1.51,0.72999999999999998,1.22,1.0600000000000001,0.51000000000000001,1.52,0.31,0.29999999999999999,0.34999999999999998,1.24,0.54000000000000004,1.3200000000000001,0.69999999999999996,0.69999999999999996,1.1599999999999999,1,0.51000000000000001,2.2999999999999998,0.54000000000000004,0.69999999999999996,0.44,1,1.3400000000000001,1.52,0.54000000000000004,1.1599999999999999,0.71999999999999997,0.70999999999999996,0.40999999999999998,0.37,1.22,0.29999999999999999,1.76,1.02,1.1599999999999999,0.32000000000000001,0.81000000000000005,0.28999999999999998,1.5,1.23,0.29999999999999999,1.51,0.34999999999999998,0.53000000000000003],"y":[720,3065,6129,8062,684,4078,7577,4428,2608,5506,5063,4919,4745,5286,6468,1154,667,17761,1052,628,878,5020,2337,776,6535,1710,1208,4360,15105,687,16240,1179,8509,7324,5746,1121,4200,919,4624,2195,5376,7821,9604,3325,1919,625,5204,907,4604,651,540,2335,3881,3679,5393,5559,2344,8846,545,4800,907,4452,1024,5013,568,7092,2122,9452,2141,2999,2018,720,5027,5854,4166,8499,3511,11527,2568,793,5291,5779,6871,5508,14956,910,544,1648,6602,9444,505,2415,5715,9216,5260,4200,3749,4235,815,11646,4724,15857,16900,5131,12454,5490,1389,2383,854,2285,5126,1949,689,5027,3220,666,2846,2107,4959,517,511,4637,9511,2430,6184,4267,1628,10618,625,638,706,8299,1637,4879,1058,3656,5314,4732,1877,14215,1178,1808,941,5619,8109,8915,1846,5554,2958,3290,683,810,6398,526,13503,4518,6202,517,2313,444,9946,6088,526,8372,798,1077],"type":"scatter","mode":"markers","name":"H","marker":{"color":"rgba(53,183,121,1)","line":{"color":"rgba(53,183,121,1)"}},"textfont":{"color":"rgba(53,183,121,1)"},"error_y":{"color":"rgba(53,183,121,1)"},"error_x":{"color":"rgba(53,183,121,1)"},"line":{"color":"rgba(53,183,121,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.32000000000000001,1.0600000000000001,0.69999999999999996,1.2,1.03,0.40000000000000002,0.46999999999999997,0.33000000000000002,1.2,0.72999999999999998,0.85999999999999999,0.46999999999999997,0.54000000000000004,0.33000000000000002,1.21,0.31,0.29999999999999999,1.7,0.40999999999999998,1.05,1.51,0.5,0.42999999999999999,0.40000000000000002,0.69999999999999996,0.32000000000000001,2.0099999999999998,0.77000000000000002,0.59999999999999998,0.29999999999999999,0.34999999999999998,1.5900000000000001,0.32000000000000001,0.69999999999999996,1.1599999999999999,0.27000000000000002,0.32000000000000001,0.81999999999999995,1.1399999999999999,0.90000000000000002,0.51000000000000001,1.5,1.04,0.29999999999999999,2.2200000000000002,0.32000000000000001,1.03,0.55000000000000004,0.69999999999999996,0.92000000000000004,0.40000000000000002,0.70999999999999996,0.31,0.29999999999999999,0.5,0.38,0.41999999999999998,0.40000000000000002,0.52000000000000002,1.51,1.21,0.29999999999999999,1,0.29999999999999999,0.81000000000000005,2.3300000000000001,1.26,0.31,0.69999999999999996,0.42999999999999999,0.90000000000000002,0.40000000000000002,1.51,0.33000000000000002,1.71,1.24,0.90000000000000002,1.5,0.38,1.51,0.29999999999999999,0.29999999999999999,1,0.54000000000000004,0.52000000000000002,0.31,1.24,1.51,0.55000000000000004,0.5,2.0099999999999998,0.56000000000000005,0.70999999999999996,0.71999999999999997,1.53,1.54,1.51,1.1100000000000001,1.5600000000000001,0.5,0.34999999999999998,0.41999999999999998,1.26,0.77000000000000002,1.05,0.95999999999999996,1.04,0.69999999999999996,1.28,0.53000000000000003,0.92000000000000004,1.01,0.32000000000000001,0.52000000000000002,0.54000000000000004,0.66000000000000003,1.1100000000000001,0.69999999999999996,0.32000000000000001,0.42999999999999999,0.27000000000000002,1,0.5,0.33000000000000002,0.46000000000000002,1.0600000000000001,1,0.77000000000000002,0.40999999999999998,0.69999999999999996,0.52000000000000002,1.53,0.51000000000000001,1.3100000000000001,0.35999999999999999,0.79000000000000004,0.29999999999999999,0.40000000000000002,1.02,0.70999999999999996,1.28,0.52000000000000002,0.63,0.75,1.6499999999999999,0.32000000000000001,0.33000000000000002,1.04,0.23999999999999999,0.5,0.5,1.25,0.31,0.70999999999999996,1.51,2.52,0.90000000000000002,1.01,1.01,1.1699999999999999,1.53,0.41999999999999998,0.94999999999999996,1.01,2.0299999999999998,0.91000000000000003,0.77000000000000002,0.40999999999999998,2.0099999999999998,0.34999999999999998,0.29999999999999999,0.52000000000000002,1.0700000000000001,0.39000000000000001,1.0600000000000001,0.54000000000000004,0.34999999999999998,0.38,1.3300000000000001,1.27,0.31,1.26,0.32000000000000001,0.38,1.51,0.33000000000000002,0.70999999999999996,0.81000000000000005,1.53,1.5,0.41999999999999998,0.69999999999999996,0.32000000000000001,0.29999999999999999,0.90000000000000002,0.32000000000000001,0.54000000000000004,1.6100000000000001,1.1799999999999999,1.0800000000000001,0.83999999999999997,0.5,0.29999999999999999,1.2,0.32000000000000001],"y":[730,5435,2184,6451,2942,883,1163,743,4387,2999,3442,1110,1684,666,5405,544,574,9777,1061,4241,15303,1565,1318,1229,1966,918,18077,3786,1305,598,859,16599,561,3253,7962,566,561,3880,6741,4455,1662,4140,7294,1013,14637,1020,3052,1948,956,4281,1050,2598,698,605,1187,1069,1235,596,2012,11739,5364,605,4528,638,2789,13242,7910,559,2987,867,4914,877,11465,854,17009,7660,3492,9954,873,14482,541,776,4882,1981,1736,1046,6994,12603,1605,2070,14745,1915,2072,2383,14344,13284,15529,6713,10766,1867,517,921,10720,2635,7010,6807,6122,3450,11147,1721,3318,5199,647,1665,1028,2101,8184,2995,918,1433,672,4480,1286,1094,1800,7836,7589,3253,611,2106,1196,9971,1188,7147,753,2907,684,1123,6169,3504,6175,1906,2157,3486,6788,730,838,4703,559,1569,1690,11089,544,2515,15110,17608,4210,6353,3948,7564,9476,921,4549,8373,15322,4049,2586,1110,15841,1092,684,1170,9532,1009,7594,1637,706,879,9876,7133,462,10886,1020,666,14616,854,2031,2725,8095,13135,984,2331,720,585,4161,718,1314,9467,6960,6561,3936,1286,447,6502,645],"type":"scatter","mode":"markers","name":"G","marker":{"color":"rgba(33,144,140,1)","line":{"color":"rgba(33,144,140,1)"}},"textfont":{"color":"rgba(33,144,140,1)"},"error_y":{"color":"rgba(33,144,140,1)"},"error_x":{"color":"rgba(33,144,140,1)"},"line":{"color":"rgba(33,144,140,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1.0600000000000001,0.59999999999999998,0.29999999999999999,0.34000000000000002,1.3999999999999999,0.5,0.54000000000000004,0.28999999999999998,1.01,0.42999999999999999,0.70999999999999996,0.69999999999999996,1.52,0.69999999999999996,0.90000000000000002,0.53000000000000003,1.74,0.38,0.54000000000000004,1,1.01,0.51000000000000001,1.6299999999999999,2.0499999999999998,1.05,0.40000000000000002,0.38,0.82999999999999996,0.33000000000000002,0.62,1.01,0.42999999999999999,0.54000000000000004,1.51,1.01,0.53000000000000003,1.1100000000000001,0.32000000000000001,0.77000000000000002,0.62,0.70999999999999996,0.71999999999999997,0.72999999999999998,0.70999999999999996,0.31,0.71999999999999997,0.53000000000000003,0.70999999999999996,0.80000000000000004,0.98999999999999999,0.72999999999999998,0.51000000000000001,1.1499999999999999,0.35999999999999999,0.32000000000000001,0.46000000000000002,0.59999999999999998,0.75,0.34000000000000002,1,0.40000000000000002,0.89000000000000001,0.70999999999999996,0.70999999999999996,1.0800000000000001,1.02,0.56999999999999995,0.57999999999999996,0.34999999999999998,0.23999999999999999,0.56999999999999995,0.23999999999999999,1.51,1.01,0.31,0.69999999999999996,0.23999999999999999,0.40999999999999998,1.0900000000000001,0.38,0.29999999999999999,0.69999999999999996,0.55000000000000004,0.55000000000000004,0.32000000000000001,1,1.03,0.95999999999999996,0.70999999999999996,1.1000000000000001,0.40999999999999998,1.6399999999999999,0.73999999999999999,0.91000000000000003,1.05,0.70999999999999996,1.7,0.5,2.0099999999999998,0.40999999999999998,0.32000000000000001,0.72999999999999998,0.32000000000000001,1.0600000000000001,0.69999999999999996,0.69999999999999996,2,1.6899999999999999,0.75,1.01,0.58999999999999997,1.6299999999999999,1.02,0.31,1.05,0.71999999999999997,0.90000000000000002,0.56999999999999995,0.41999999999999998,0.29999999999999999,0.29999999999999999,0.71999999999999997,0.73999999999999999,0.41999999999999998,1.1000000000000001,1.71,1.52,1,0.29999999999999999,0.69999999999999996,1.0600000000000001,0.35999999999999999,0.31,0.52000000000000002,0.41999999999999998,0.40000000000000002,1,1.5700000000000001,1,1.0700000000000001,0.90000000000000002,0.29999999999999999,1.1200000000000001,0.91000000000000003,0.32000000000000001,0.90000000000000002,0.29999999999999999,0.90000000000000002,1.23,0.26000000000000001,0.54000000000000004,0.78000000000000003,1.51,0.33000000000000002,0.54000000000000004,0.35999999999999999,0.29999999999999999,0.40000000000000002,0.40000000000000002,1.3700000000000001,1.0600000000000001,0.75,0.69999999999999996,2,0.39000000000000001,1,1,0.5,0.81999999999999995,0.33000000000000002,0.58999999999999997,0.31,0.38,0.56000000000000005,0.34000000000000002,0.31],"y":[4372,1323,790,1071,12401,1654,1013,633,8922,1358,2381,2591,7320,2671,5386,2259,14775,998,1889,5292,6366,1744,7100,17957,5586,1168,1087,3774,854,2861,10476,968,1097,13010,7792,1220,4227,533,2107,2406,2291,2787,2841,2807,749,2673,1821,3281,2762,5893,3669,1308,5635,803,645,983,2142,2734,724,6013,579,4854,2381,2633,4953,4948,1397,1442,906,552,1751,461,11374,6159,917,1087,393,904,4629,1218,945,2167,1410,1449,886,6183,4586,4218,2839,7762,863,13289,3948,4474,9092,2839,18598,1147,17005,878,828,2933,947,6947,2551,2726,10494,14242,2501,6707,1195,12394,7587,459,9138,2568,4715,1257,1082,641,780,3495,4157,626,7509,8714,11776,6608,500,2810,6363,684,523,1720,1221,673,7204,11523,6223,5240,4435,605,7589,3963,1068,5000,684,3951,9376,447,1260,3429,10838,666,1745,708,751,1323,982,6181,4634,2933,2737,16580,697,5122,4480,1679,4141,739,1424,1818,800,1708,745,874],"type":"scatter","mode":"markers","name":"F","marker":{"color":"rgba(49,104,142,1)","line":{"color":"rgba(49,104,142,1)"}},"textfont":{"color":"rgba(49,104,142,1)"},"error_y":{"color":"rgba(49,104,142,1)"},"error_x":{"color":"rgba(49,104,142,1)"},"line":{"color":"rgba(49,104,142,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.40999999999999998,0.70999999999999996,0.69999999999999996,1.01,0.83999999999999997,0.71999999999999997,0.70999999999999996,0.55000000000000004,0.29999999999999999,0.57999999999999996,1.01,0.70999999999999996,0.38,0.52000000000000002,1.21,0.90000000000000002,0.79000000000000004,0.40000000000000002,0.51000000000000001,0.37,0.51000000000000001,0.52000000000000002,0.54000000000000004,1.04,0.91000000000000003,0.38,0.54000000000000004,1.6499999999999999,0.52000000000000002,1.5,0.5,0.55000000000000004,0.34999999999999998,0.38,0.32000000000000001,1.5,0.34999999999999998,1.01,0.53000000000000003,1.2,0.91000000000000003,0.54000000000000004,0.26000000000000001,0.80000000000000004,0.55000000000000004,0.38,1,0.90000000000000002,0.40999999999999998,1.02,1.1100000000000001,0.33000000000000002,0.25,0.29999999999999999,0.31,0.34999999999999998,0.31,0.5,0.34999999999999998,0.72999999999999998,1.0600000000000001,0.29999999999999999,0.51000000000000001,0.92000000000000004,0.69999999999999996,1.5800000000000001,0.42999999999999999,0.56000000000000005,0.27000000000000002,0.51000000000000001,0.32000000000000001,0.54000000000000004,0.26000000000000001,0.69999999999999996,1.54,0.34000000000000002,1.01,0.69999999999999996,0.72999999999999998,1,1.51,1.01,0.35999999999999999,0.5,1.1100000000000001,1,0.34999999999999998,1.2,0.90000000000000002,0.90000000000000002,0.29999999999999999,1.21,0.51000000000000001,1,0.71999999999999997,1.74,2,0.37,0.51000000000000001,1.55,0.56000000000000005,0.28000000000000003,1.0800000000000001,0.42999999999999999,0.31,0.40999999999999998,0.35999999999999999,0.40000000000000002,1.01,0.83999999999999997,0.33000000000000002,0.79000000000000004,1.1000000000000001,0.52000000000000002,1.1200000000000001,0.69999999999999996,0.53000000000000003,0.53000000000000003,0.33000000000000002,0.77000000000000002,0.69999999999999996,1.73,0.34000000000000002,1,0.32000000000000001,0.29999999999999999,0.34000000000000002,0.75,1.1299999999999999,0.40999999999999998,0.40000000000000002,0.25,0.34999999999999998,0.32000000000000001,0.31,0.58999999999999997,1,0.33000000000000002,0.55000000000000004,1.7,0.77000000000000002,1.6299999999999999,0.23999999999999999,0.70999999999999996,0.51000000000000001,0.77000000000000002,0.51000000000000001,0.51000000000000001,0.33000000000000002,0.91000000000000003,0.5,1.5,1.0600000000000001,0.81000000000000005,0.75,0.70999999999999996,0.40999999999999998,0.25,0.27000000000000002,0.51000000000000001,0.29999999999999999,0.73999999999999999,0.70999999999999996,0.33000000000000002,0.38,0.51000000000000001,0.34999999999999998,0.37,0.25,0.33000000000000002,0.40999999999999998,0.40999999999999998,1.03,0.35999999999999999],"y":[1079,3238,3154,4921,3086,2265,2573,1975,526,1893,5430,3831,660,1369,8863,3800,3390,1397,2691,1041,1781,2230,1112,3392,4623,1112,1637,8455,3097,9828,2003,1831,788,1000,842,11795,1063,5002,984,13597,2464,1246,724,2829,1996,866,3696,4315,775,6032,4177,723,535,844,680,767,698,1155,788,3607,11518,766,2524,4258,2453,7963,739,1737,577,1906,1020,1847,554,2695,8020,875,6517,2164,3066,6720,12655,5973,789,1676,7459,4620,900,8602,4165,4092,421,7703,1438,5239,2857,15847,12210,493,1434,6901,1930,487,10300,1209,1188,1079,631,975,6310,4318,579,3861,4472,1806,7589,2952,1160,2263,594,3234,2514,15842,641,3300,900,526,702,2278,6682,1082,1125,575,984,960,942,1838,4805,873,1551,12030,2723,10357,367,2511,1343,2975,1437,1343,1114,3438,1410,11795,8567,2901,2993,2863,904,576,603,1732,943,3416,3053,814,866,1812,788,1082,576,579,969,1079,5710,789],"type":"scatter","mode":"markers","name":"E","marker":{"color":"rgba(68,58,131,1)","line":{"color":"rgba(68,58,131,1)"}},"textfont":{"color":"rgba(68,58,131,1)"},"error_y":{"color":"rgba(68,58,131,1)"},"error_x":{"color":"rgba(68,58,131,1)"},"line":{"color":"rgba(68,58,131,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.29999999999999999,1.51,0.34999999999999998,0.40999999999999998,0.34999999999999998,0.29999999999999999,0.33000000000000002,1.52,0.32000000000000001,0.70999999999999996,0.29999999999999999,0.80000000000000004,0.40999999999999998,0.40000000000000002,0.34999999999999998,0.71999999999999997,1.1899999999999999,0.41999999999999998,0.78000000000000003,0.53000000000000003,1.02,0.56000000000000005,0.55000000000000004,1.21,0.29999999999999999,0.41999999999999998,1.5,0.55000000000000004,0.33000000000000002,0.78000000000000003,1.01,0.33000000000000002,1.02,1.01,1.01,0.35999999999999999,0.39000000000000001,0.41999999999999998,0.31,0.70999999999999996,0.34999999999999998,0.29999999999999999,0.5,0.31,0.69999999999999996,0.32000000000000001,0.58999999999999997,0.40999999999999998,0.31,1.01,0.34999999999999998,0.38,0.52000000000000002,1.52,1.52,0.69999999999999996,0.31,0.72999999999999998,1.01,1.2,0.51000000000000001,0.79000000000000004,0.31,0.90000000000000002,1.04,0.41999999999999998,1.0600000000000001,1.51,1.23,0.27000000000000002,0.52000000000000002,0.56000000000000005,0.33000000000000002,0.29999999999999999,0.33000000000000002,0.53000000000000003,0.33000000000000002,1.3500000000000001,0.31,0.40999999999999998,0.54000000000000004,0.34000000000000002,0.52000000000000002,0.51000000000000001,0.32000000000000001,0.42999999999999999,0.41999999999999998,0.51000000000000001,0.55000000000000004,0.23999999999999999,0.27000000000000002,0.40999999999999998,1,0.5,0.31,0.34000000000000002,0.51000000000000001,0.31,0.59999999999999998,1.5,1.5,0.55000000000000004,0.53000000000000003,0.81000000000000005,0.73999999999999999,0.42999999999999999,0.34000000000000002,0.69999999999999996,0.5,0.23000000000000001,0.35999999999999999,0.40999999999999998,1.03,0.29999999999999999,0.34000000000000002,0.81999999999999995,0.55000000000000004,0.77000000000000002,0.52000000000000002,0.54000000000000004,0.29999999999999999,0.31,1,0.69999999999999996,0.29999999999999999,1.23,0.40999999999999998,0.29999999999999999,0.46999999999999997,0.55000000000000004,1.05,1.2,0.78000000000000003,0.32000000000000001,0.90000000000000002],"y":[710,14205,790,738,1063,814,781,12823,1252,2822,911,3135,1151,1123,829,3099,12795,898,2799,1318,4318,3496,1698,17192,651,1040,11442,2030,839,3811,7448,1021,6863,12996,11661,928,1290,910,734,3674,1063,709,1845,1310,2833,589,1419,818,593,3605,1247,1117,1828,10512,9817,2444,942,2841,8201,5451,2177,4213,732,4120,10984,810,12053,17111,3977,419,1284,1753,608,911,736,1877,762,10796,942,1015,1786,923,1774,1569,924,830,1103,1787,1272,485,799,1230,6020,1610,571,957,2289,684,1996,10302,13603,1755,1576,2994,2753,1199,626,1987,1610,362,626,1230,4764,552,1133,4113,1894,3428,1600,1892,709,734,5227,2546,552,7799,1427,709,2086,2030,6063,15686,2722,1066,4187],"type":"scatter","mode":"markers","name":"D","marker":{"color":"rgba(68,1,84,1)","line":{"color":"rgba(68,1,84,1)"}},"textfont":{"color":"rgba(68,1,84,1)"},"error_y":{"color":"rgba(68,1,84,1)"},"error_x":{"color":"rgba(68,1,84,1)"},"line":{"color":"rgba(68,1,84,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Plot_ly can do a lot more than this example shows, including animation. There is a lot of documentation you can find at the link under Further Reading.</p>
</section><section id="animations" class="level2" data-number="27.3"><h2 data-number="27.3" class="anchored" data-anchor-id="animations">
<span class="header-section-number">27.3</span> Animations</h2>
<p>Let’s recreate a version of Rosling’s plot of life expectancy as a function of income over time.</p>
<p>First we’ll make the plot for just one year. Then we will animate the plot changing year over time in the animation.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1957</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>, x <span class="op">=</span> <span class="fl">3.8</span>, y <span class="op">=</span> <span class="fl">50</span>, size <span class="op">=</span> <span class="fl">40</span>, color <span class="op">=</span> <span class="st">"lightgray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>,</span>
<span>             y <span class="op">=</span> <span class="va">lifeExp</span>,</span>
<span>             size <span class="op">=</span> <span class="va">pop</span>,</span>
<span>             color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_text(aes(label = min(year)), x = 3.8, y = 50, size = 40, : All aesthetics have length 1, but the data has 142 rows.
ℹ Please consider using `annotate()` or provide this layer with data containing
  a single row.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="155-dynamics-graphics_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now we will use functions from the <code>gganimate</code> package to change year from one frame to the next. Here we use <code>transition_state</code> to change the plot along values of <code>year</code>. The animation is produced with just one function: <code>transition_time(year)</code> which uses the quantitative value of year to control the display of data over time. The code to show the year in the <code>geom_text</code> is not at all obvious.</p>
<p>The results are not shown here, but this code should work in Rstudio.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">animation</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            x <span class="op">=</span> <span class="fl">3.8</span>, y <span class="op">=</span> <span class="fl">50</span>, </span>
<span>            size <span class="op">=</span> <span class="fl">40</span>, color <span class="op">=</span> <span class="st">"lightgray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gdpPercap</span>,</span>
<span>             y <span class="op">=</span> <span class="va">lifeExp</span>,</span>
<span>             size <span class="op">=</span> <span class="va">pop</span>,</span>
<span>             color <span class="op">=</span> <span class="va">continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_x_log10</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">transition_time</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Animation frame {frame} of {nframes}"</span><span class="op">)</span></span>
<span><span class="fu">animate</span><span class="op">(</span><span class="va">animation</span>, nframes <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="further-reading" class="level2" data-number="27.4"><h2 data-number="27.4" class="anchored" data-anchor-id="further-reading">
<span class="header-section-number">27.4</span> Further reading</h2>
<ul>
<li>Documentation for <a href="https://plotly.com/r/">plot_ly</a> graphics for R</li>
<li>Documentation for <a href="https://gganimate.com/index.html">gganimate</a>, the grammar of animations</li>
</ul>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../lessons/127-test-data.html" class="pagination-link" aria-label="Checking your work">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Checking your work</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../lessons/140-mapping.html" class="pagination-link" aria-label="Making maps">
        <span class="nav-page-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Making maps</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>